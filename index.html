<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ğŸ® AIäººç”Ÿæ¨¡æ‹Ÿå™¨</title>
<style>
body{font-family:'Microsoft YaHei';background:#1a1a2e;color:#fff;padding:20px;margin:0;min-height:100vh}
.game-container{max-width:900px;margin:0 auto}
.year-display{text-align:center;font-size:28px;color:#ffd700;margin-bottom:10px}
.age-phase{text-align:center;font-size:14px;color:#00ff88;margin-bottom:15px}
.goal-box,.fortune-box{text-align:center;padding:10px;border-radius:10px;margin-bottom:15px}
.goal-box{background:linear-gradient(135deg,rgba(0,255,136,0.1),rgba(0,204,255,0.1));border:1px solid rgba(0,255,136,0.3)}
.fortune-box{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,165,0,0.2));border:1px solid rgba(255,215,0,0.3)}
.goal-label,.fortune-label{font-size:12px}
.goal-label{color:#00ff88}.fortune-label{color:#ffd700}
.goal-text,.fortune-text{font-size:14px;color:#fff}
.status-bar{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-bottom:15px}
.stat-item{background:rgba(0,0,0,0.3);padding:8px;border-radius:8px;text-align:center}
.stat-label{font-size:10px;color:#888;margin-bottom:4px}
.stat-value{font-size:14px;font-weight:bold}
.stat-bar{height:4px;background:rgba(255,255,255,0.1);border-radius:2px;margin-top:4px;overflow:hidden}
.stat-fill{height:100%;border-radius:2px;transition:width 0.3s}
.extra-attrs{text-align:center;margin-bottom:15px;padding:10px;background:rgba(0,0,0,0.3);border-radius:10px}
.extra-attr{display:inline-block;margin:3px 8px;padding:5px 12px;background:rgba(255,255,255,0.1);border-radius:20px;font-size:12px}
.extra-attr span{color:#00ff88;font-weight:bold}
.main-area{display:grid;grid-template-columns:200px 1fr;gap:20px}
@media(max-width:750px){.main-area{grid-template-columns:1fr}.status-bar{grid-template-columns:repeat(3,1fr)}}
.avatar{font-size:50px;text-align:center;margin-bottom:10px}
.char-name{text-align:center;font-size:18px;margin-bottom:5px}
.char-info{text-align:center;color:#888;font-size:12px}
.skills-list{display:flex;flex-wrap:wrap;gap:5px;margin-top:10px}
.skill-tag{background:rgba(255,255,255,0.1);padding:3px 8px;border-radius:10px;font-size:11px}
.event-log{font-size:11px;max-height:150px;overflow-y:auto;margin-top:10px}
.story-panel{background:rgba(0,0,0,0.3);padding:15px;border-radius:10px;flex:1}
.scene-image{font-size:40px;text-align:center;margin-bottom:10px}
.npc-area{display:flex;gap:10px;margin-bottom:10px;align-items:flex-start}
.npc-avatar{font-size:30px;position:relative;cursor:pointer}
.speak-btn{position:absolute;bottom:-5px;right:-5px;font-size:12px;background:#00ff88;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center}
.dialogue-box{background:rgba(255,255,255,0.05);padding:10px;border-radius:8px;flex:1}
.npc-name{color:#ffd700;font-size:12px;margin-bottom:5px}
.choices-title{font-size:14px;color:#00ccff;margin:10px 0}
.choice-btn{display:block;width:100%;padding:12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;text-align:left;margin-bottom:8px;cursor:pointer;transition:all 0.2s}
.choice-btn:hover{background:rgba(0,255,136,0.2);border-color:#00ff88}
.choice-btn:disabled{opacity:0.5;cursor:not-allowed}
.choice-btn.legendary{background:linear-gradient(135deg,rgba(255,215,0,0.3),rgba(255,165,0,0.3));border-color:#ffd700}
.choice-btn.legendary:hover{background:linear-gradient(135deg,rgba(255,215,0,0.5),rgba(255,165,0,0.5))}
.legendary-tag{font-size:10px;background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000;padding:2px 6px;border-radius:8px;margin-left:5px}
.blocked-tag{font-size:10px;background:#ff4444;color:#fff;padding:2px 6px;border-radius:8px;margin-left:5px}
.result-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:100}
.result-box{background:linear-gradient(135deg,#1a1a2e,#16213e);padding:30px;border-radius:20px;text-align:center;max-width:550px;border:2px solid #00ff88}
.result-title{font-size:24px;color:#00ff88;margin-bottom:15px}
.result-text{font-size:16px;line-height:2;margin-bottom:20px;text-align:left;white-space:pre-line}
.result-btn{padding:12px 30px;background:linear-gradient(135deg,#00ff88,#00ccff);border:none;border-radius:10px;color:#000;font-size:16px;font-weight:bold;cursor:pointer}
.loading{font-size:14px;color:#00ccff;animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.free-input{margin-top:15px}
.free-input input{width:100%;padding:10px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff}
.free-input button{margin-top:8px;padding:10px 20px;background:#00ff88;border:none;border-radius:8px;color:#000;font-weight:bold;cursor:pointer}
</style>
</head>
<body>
<div class="game-container">
<div class="year-display" id="yearDisplay">ğŸ‚ ç¬¬ 0 å¹´</div>
<div class="age-phase" id="agePhase">å©´å„¿æœŸ</div>
<div class="goal-box"><div class="goal-label">ğŸ¯ äººç”Ÿç›®æ ‡</div><div class="goal-text" id="goalText">-</div></div>
<div class="fortune-box"><div class="fortune-label">ğŸ”® ä»Šå¹´è¿åŠ¿</div><div class="fortune-text" id="fortuneText">-</div></div>
<div class="status-bar">
<div class="stat-item"><div class="stat-label">â¤ï¸ ç”Ÿå‘½</div><div class="stat-value" id="life">100/200</div><div class="stat-bar"><div class="stat-fill" id="lifeBar" style="width:50%;background:#ff4444"></div></div></div>
<div class="stat-item"><div class="stat-label">ğŸ’š å¥åº·</div><div class="stat-value" id="health">50/200</div><div class="stat-bar"><div class="stat-fill" id="healthBar" style="width:25%;background:#00ff88"></div></div></div>
<div class="stat-item"><div class="stat-label">ğŸ’° é‡‘é’±</div><div class="stat-value" id="money">Â¥0</div></div>
<div class="stat-item"><div class="stat-label">ğŸ§  æ™ºåŠ›</div><div class="stat-value" id="intelligence">10/200</div><div class="stat-bar"><div class="stat-fill" id="intBar" style="width:5%;background:#00ccff"></div></div></div>
<div class="stat-item"><div class="stat-label">âœ¨ é­…åŠ›</div><div class="stat-value" id="charm">10/200</div><div class="stat-bar"><div class="stat-fill" id="charmBar" style="width:5%;background:#ff6b6b"></div></div></div>
<div class="stat-item"><div class="stat-label">ğŸ€ å¹¸è¿</div><div class="stat-value" id="luck">10/200</div><div class="stat-bar"><div class="stat-fill" id="luckBar" style="width:5%;background:#ffd700"></div></div></div>
<div class="stat-item"><div class="stat-label">â­ å£°æœ›</div><div class="stat-value" id="fame">0</div></div>
</div>
<div class="extra-attrs" id="extraAttrs"></div>
<div class="main-area">
<div class="left-panel">
<div class="avatar" id="avatar">ğŸ‘¶</div>
<div class="char-name" id="charName">å©´å„¿</div>
<div class="char-info" id="charInfo">0å²</div>
<div style="margin-top:15px"><div style="color:#00ff88;font-size:12px;margin-bottom:5px">ğŸ¯ æŠ€èƒ½</div><div class="skills-list" id="skillsList"><span class="skill-tag">æ— </span></div></div>
<div style="margin-top:15px"><div style="color:#00ff88;font-size:12px;margin-bottom:5px">ğŸ“œ ç»å†</div><div class="event-log" id="eventLog"><div>ğŸŒŸ ä½ å‡ºç”Ÿäº†</div></div></div>
</div>
<div class="center-area">
<div class="story-panel">
<div class="scene-image" id="sceneImage">ğŸ¥</div>
<div class="npc-area">
<div class="npc-avatar" id="npcAvatar" onclick="speakText()">ğŸ‘©<div class="speak-btn">ğŸ”Š</div></div>
<div class="dialogue-box">
<div class="npc-name" id="npcName">å¦ˆå¦ˆ</div>
<div id="dialogueText">å®è´ï¼Œæ¬¢è¿ï¼</div>
</div>
</div>
</div>
<div class="choices-panel">
<div class="choices-title">âœ¨ ä½ å†³å®šï¼š</div>
<div id="choicesList"></div>
<div class="free-input"><input type="text" id="freeInput" placeholder="ğŸ’¬ è¾“å…¥ä½ çš„æƒ³æ³•"><button id="submitBtn">æäº¤</button></div>
</div>
</div>
</div>
</div>
<div class="result-overlay" id="resultOverlay" style="display:none">
<div class="result-box">
<div class="result-title">ğŸ“ ä»Šå¹´å‘ç”Ÿäº†ä»€ä¹ˆ</div>
<div class="result-text" id="resultText"></div>
<button class="result-btn" id="nextBtn" onclick="nextYear()">è¿›å…¥ä¸‹ä¸€å¹´ â¡ï¸</button>
</div>
</div>
<script>
var gameState={age:0,life:100,health:50,money:0,intelligence:10,charm:10,luck:10,fame:0,skills:[],events:[],job:"å©´å„¿",relationship:0,careerLevel:0,goal:"",fortune:"",extraAttrs:{},usedLegendaryChoices:[]};
var goals=["æˆä¸ºäº¿ä¸‡å¯Œç¿ ğŸ¤‘","æ‰¾åˆ°çœŸçˆ± ğŸ’•","ç¯æ¸¸ä¸–ç•Œ ğŸŒ","æ”¹å˜ä¸–ç•Œ ğŸŒ","æˆä¸ºè¡Œä¸šç²¾è‹± ğŸ’¼","æ‹¥æœ‰å¹¸ç¦å®¶åº­ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§","æ´»åˆ°100å² ğŸ‚","æˆä¸ºçŸ¥åäººç‰© â­","å¸®åŠ©ä»–äºº ğŸ™Œ","å®ç°è´¢åŠ¡è‡ªç”± ğŸ’°","æ‹¥æœ‰è‡ªå·±çš„å…¬å¸ ğŸ¢","æˆä¸ºè‰ºæœ¯å®¶ ğŸ¨"];
var fortunes=["ä»Šå¹´äº‹ä¸šè¿åŠ¿ä¸é”™ ğŸ’ª","å¥åº·è¿åŠ¿ä¸‹æ»‘ âš ï¸","è´¢è¿äº¨é€š ğŸ’°","äººé™…å…³ç³»æ´»è·ƒ ğŸ¤","å­¦ä¹ è¿åŠ¿æ—ºç›› ğŸ“š","çˆ±æƒ…è¿åŠ¿æ¥ä¸´ ğŸ’•","æ•´ä½“å¹³ç¨³ ğŸŒŠ","æŒ‘æˆ˜ä¸æœºé‡å¹¶å­˜ ğŸš€","é€‚åˆä¼‘æ¯ ğŸ§˜","åˆ›é€ åŠ›çˆ†å‘ ğŸ¨"];

var legendaryOptions={
    "aosai":{text:"ğŸ† å‚åŠ å¥¥èµ›",minAge:12,condition:function(s){return s.intelligence>=50},effect:{fame:10,intelligence:8},result:"ä½ è·å¾—çœçº§å¥¥èµ›ä¸€ç­‰å¥–ï¼"},
    "chuangye_u":{text:"ğŸš€ åˆ›ä¸šå¤§èµ›",minAge:18,condition:function(s){return s.intelligence>=60},effect:{money:12000,fame:10},result:"ä½ è·å¾—åˆ›ä¸šå¤§èµ›å† å†›ï¼"},
    "jiehun":{text:"ğŸ’ ç»“å©š",minAge:22,condition:function(s){return s.relationship>=25},effect:{relationship:35,money:5000,health:5},result:"ä½ å’ŒTAæ­¥å…¥å©šå§»æ®¿å ‚ï¼"},
    "chuangye_m":{text:"ğŸ­ åˆ›ä¸šå½“CEO",minAge:28,condition:function(s){return s.money>=30000},effect:{money:-20000,fame:15,career:3},result:"ä½ åˆ›åŠäº†è‡ªå·±çš„å…¬å¸ï¼"},
    "tv_star":{text:"ğŸ“º ä¸Šç”µè§†",minAge:22,condition:function(s){return s.charm>=60},effect:{fame:12,money:3000},result:"ä½ ç™»ä¸Šç”µè§†èŠ‚ç›®ï¼"},
    "lottery":{text:"ğŸ° ä¸­å½©ç¥¨",minAge:18,condition:function(s){return s.luck>=80},effect:{money:50000},result:"ä½ ä¸­äº†å½©ç¥¨ï¼"}
};

function getAgePhase(age){
    if(age<3)return{name:"ğŸ‘¶ å©´å„¿æœŸ",npc:"å¦ˆå¦ˆ",scene:"ğŸ¥",avatar:"ğŸ‘©"};
    if(age<6)return{name:"ğŸ§’ å¹¼å„¿æœŸ",npc:"çˆ¸çˆ¸",scene:"ğŸ ",avatar:"ğŸ‘¨"};
    if(age<12)return{name:"ğŸ« å°å­¦æœŸ",npc:"è€å¸ˆ",scene:"ğŸ«",avatar:"ğŸ‘¨â€ğŸ«"};
    if(age<18)return{name:"ğŸ“š ä¸­å­¦æœŸ",npc:"ç­ä¸»ä»»",scene:"ğŸ«",avatar:"ğŸ‘©â€ğŸ«"};
    if(age<22)return{name:"ğŸ“ å¤§å­¦æœŸ",npc:"å­¦é•¿",scene:"ğŸ«",avatar:"ğŸ‘¨â€ğŸ“"};
    if(age<30)return{name:"ğŸ’¼ åˆèŒæœŸ",npc:"ä¸Šå¸",scene:"ğŸ¢",avatar:"ğŸ‘¨â€ğŸ’¼"};
    if(age<45)return{name:"ğŸ¢ èŒä¸šæœŸ",npc:"åŒäº‹",scene:"ğŸ¢",avatar:"ğŸ‘”"};
    if(age<60)return{name:"ğŸ‘” ä¸­å¹´æœŸ",npc:"æœ‹å‹",scene:"ğŸ ",avatar:"ğŸ‘«"};
    return{name:"ğŸ‘´ è€å¹´æœŸ",npc:"å­å¥³",scene:"ğŸ ",avatar:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§"};
}

function getChoices(age,state){
    var isAdult=age>=18;
    var choices=[];
    
    if(age<3){
        choices=[{text:"ğŸ˜Š å¥åº·æˆé•¿",effect:{health:8}},{text:"ğŸ˜¢ å“­é—¹è¡¨è¾¾",effect:{charm:5}},{text:"ğŸ˜´ å®‰é™ç¡è§‰",effect:{health:5}},{text:"ğŸ‘€ å¥½å¥‡è§‚å¯Ÿ",effect:{intelligence:5,luck:3}}];
    }else if(age<6){
        choices=[{text:"ğŸš— ç©ç©å…·è½¦",effect:{intelligence:8}},{text:"ğŸ¨ ç”»ç”»",effect:{intelligence:5,charm:5}},{text:"ğŸ‘« äº¤å°æœ‹å‹",effect:{charm:8}},{text:"ğŸ“– å¬æ•…äº‹",effect:{intelligence:5,luck:3}}];
    }else if(age<12){
        choices=[{text:"ğŸ“ å­¦æ•°å­¦",effect:{intelligence:10}},{text:"ğŸ“š è¯»è¯¾å¤–ä¹¦",effect:{intelligence:8,luck:3}},{text:"âš½ è¸¢è¶³çƒ",effect:{health:10}},{text:"ğŸµ å­¦é’¢ç´",effect:{charm:10}}];
    }else if(age<18){
        choices=[{text:"ğŸ“– åŠªåŠ›å­¦ä¹ ",effect:{intelligence:12}},{text:"ğŸ€ æ‰“ç¯®çƒ",effect:{health:12}},{text:"ğŸ’• è°ˆæ‹çˆ±",effect:{charm:8,relationship:5}},{text:"ğŸƒ è·‘æ­¥é”»ç‚¼",effect:{health:12}}];
        if(state.intelligence>=50&&state.usedLegendaryChoices.indexOf("aosai")===-1)choices.push({text:"ğŸ† å‚åŠ å¥¥èµ›",effect:{fame:10,intelligence:8},result:"å¥¥èµ›è·å¥–ï¼",legendary:true,key:"aosai"});
    }else if(age<22){
        choices=[{text:"ğŸ“š è€ƒç ”æ·±é€ ",effect:{intelligence:15}},{text:"ğŸ’¼ æ‰¾å®ä¹ ",effect:{money:5000,career:2}},{text:"ğŸ­ å‚åŠ ç¤¾å›¢",effect:{charm:12}},{text:"ğŸ’ª å¥èº«æˆ¿",effect:{health:15}}];
        if(state.intelligence>=60&&state.usedLegendaryChoices.indexOf("chuangye_u")===-1)choices.push({text:"ğŸš€ åˆ›ä¸šå¤§èµ›",effect:{money:12000,fame:10},result:"åˆ›ä¸šå¤§èµ›å† å†›ï¼",legendary:true,key:"chuangye_u"});
    }else if(age<30){
        choices=[{text:"ğŸ’ª æ‹¼å‘½å·¥ä½œ",effect:{money:15000,career:2,health:-2}},{text:"ğŸ’• æ‰¾å¯¹è±¡",effect:{relationship:10}},{text:"ğŸ“š ç»§ç»­å­¦ä¹ ",effect:{intelligence:15}},{text:"ğŸƒ å…»ç”Ÿä¿å¥",effect:{health:15}}];
        if(state.relationship>=25&&state.usedLegendaryChoices.indexOf("jiehun")===-1)choices.push({text:"ğŸ’ ç»“å©š",effect:{relationship:35,money:5000,health:5},result:"ç»“å©šï¼",legendary:true,key:"jiehun"});
        if(state.charm>=60&&state.usedLegendaryChoices.indexOf("tv_star")===-1)choices.push({text:"ğŸ“º ä¸Šç”µè§†",effect:{fame:12,money:3000},result:"ä¸Šç”µè§†ï¼",legendary:true,key:"tv_star"});
    }else if(age<45){
        choices=[{text:"ğŸ’¼ ä¸“æ³¨äº‹ä¸š",effect:{money:25000,career:2,health:-2}},{text:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ç»“å©šç”Ÿå­",effect:{relationship:15}},{text:"ğŸƒ é”»ç‚¼èº«ä½“",effect:{health:15}},{text:"ğŸ¤ æ¼”è®²",effect:{fame:10}}];
        if(state.money>=30000&&state.usedLegendaryChoices.indexOf("chuangye_m")===-1)choices.push({text:"ğŸ­ åˆ›ä¸šå½“CEO",effect:{money:-20000,fame:15,career:3},result:"åˆ›ä¸šï¼",legendary:true,key:"chuangye_m"});
        if(state.luck>=80&&state.usedLegendaryChoices.indexOf("lottery")===-1)choices.push({text:"ğŸ° ä¸­å½©ç¥¨",effect:{money:50000},result:"ä¸­å½©ç¥¨ï¼",legendary:true,key:"lottery"});
    }else if(age<60){
        choices=[{text:"ğŸ’¼ ç¨³å®šå·¥ä½œ",effect:{money:18000,health:-1}},{text:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ ç…§é¡¾å®¶åº­",effect:{relationship:10,health:5}},{text:"ğŸƒ å…»ç”Ÿä¿å¥",effect:{health:15}},{text:"ğŸŒ å»æ—…è¡Œ",effect:{money:10000,charm:8}}];
    }else{
        choices=[{text:"ğŸ’° é¢†å–é€€ä¼‘é‡‘",effect:{money:8000}},{text:"âœï¸ å†™å›å¿†å½•",effect:{fame:10,intelligence:5}},{text:"ğŸ‘¶ å«é¥´å¼„å­™",effect:{health:10,relationship:10}},{text:"ğŸŒ± ç§èŠ±å…»è‰",effect:{health:15,luck:5}}];
    }
    
    choices=choices.filter(function(c){if(!isAdult&&c.effect.money&&c.effect.money<0)return false;return true});
    choices.forEach(function(c){if(c.effect.money&&c.effect.money<0&&state.money+c.effect.money<0)c.blocked=true});
    return choices;
}

function getDialogue(age){
    var d={0:"å®è´ï¼Œæ¬¢è¿ï¼",3:"3å²ä¸Šå¹¼å„¿å›­ï¼",6:"ä¸Šå°å­¦ï¼",12:"ä¸Šåˆä¸­ï¼",15:"é«˜ä¸­ï¼",18:"æˆå¹´ï¼",22:"å¤§å­¦æ¯•ä¸šï¼",30:"30è€Œç«‹ï¼",40:"40ä¸æƒ‘ï¼",50:"50çŸ¥å¤©å‘½ï¼",60:"60é€€ä¼‘ï¼"};
    for(var i=age;i>=0;i--)if(d[i])return d[i];
    return "ä»Šå¹´"+age+"å²...";
}

function generateGoal(){gameState.goal=goals[Math.floor(Math.random()*goals.length)];document.getElementById('goalText').textContent=gameState.goal;}
function generateFortune(){gameState.fortune=fortunes[Math.floor(Math.random()*fortunes.length)];document.getElementById('fortuneText').textContent=gameState.fame>100?"â­ é¸¿è¿å½“å¤´ï¼":gameState.fortune;}

function speakText(){
    var utterance=new SpeechSynthesisUtterance(document.getElementById('dialogueText').textContent);
    utterance.lang='zh-CN';
    speechSynthesis.speak(utterance);
}

function applyEffect(effect){
    if(!effect)return;
    if(effect.money)gameState.money+=effect.money;
    if(effect.life)gameState.life+=effect.life;
    if(effect.health)gameState.health+=effect.health;
    if(effect.intelligence)gameState.intelligence+=effect.intelligence;
    if(effect.charm)gameState.charm+=effect.charm;
    if(effect.luck)gameState.luck+=effect.luck;
    if(effect.fame)gameState.fame+=effect.fame;
    if(effect.career)gameState.careerLevel+=effect.career;
    if(effect.relationship)gameState.relationship+=effect.relationship;
    gameState.money=Math.max(0,gameState.money);
    gameState.life=Math.max(0,Math.min(200,gameState.life));
    gameState.health=Math.max(0,Math.min(200,gameState.health));
    gameState.intelligence=Math.max(0,Math.min(200,gameState.intelligence));
    gameState.charm=Math.max(0,Math.min(200,gameState.charm));
    gameState.luck=Math.max(0,Math.min(200,gameState.luck));
}

function checkGameOver(){if(gameState.life<=0){alert('ğŸ’€ æ¸¸æˆç»“æŸï¼');return true;}return false;}

async function generateAIResult(choiceText,age,phase){
    var prompt="ä½ æ˜¯ä¸€ä¸ªäººç”Ÿæ¨¡æ‹Ÿæ¸¸æˆçš„å™è¿°è€…ã€‚è¯·ä¸ºç©å®¶çš„é€‰æ‹©ç”Ÿæˆä¸€æ®µè¯¦ç»†ç”ŸåŠ¨çš„æ•…äº‹æè¿°ï¼ˆ150-250å­—ï¼‰ã€‚ç©å®¶"+age+"å²ï¼Œå¤„äº"+phase+"ã€‚ç©å®¶é€‰æ‹©äº†ï¼šã€Œ"+choiceText+"ã€ã€‚è¦æ±‚ï¼š1.æè¿°ç”ŸåŠ¨æœ‰è¶£ 2.æœ‰å¿ƒç†æ´»åŠ¨ 3.ç”¨ç¬¬ä¸€äººç§° 4.æ•…äº‹æœ‰èµ·ä¼ã€‚ç›´æ¥è¾“å‡ºï¼š";
    try{
        var resp=await fetch('https://api.minimax.chat/v1/text/chatcompletion_pro',{
            method:'POST',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({model:"abab6.5s-chat",messages:[{role:"user",content:prompt}],max_tokens:400,temperature:0.8})
        });
        var data=await resp.json();
        if(data.choices&&data.choices[0]&&data.choices[0].message)return data.choices[0].message.content.trim();
    }catch(e){}
    return null;
}

async function showResult(choice){
    var phase=getAgePhase(gameState.age).name;
    var resultText="";
    if(choice.legendary){resultText=choice.result||choice.text+"ï¼";}
    else{
        document.getElementById('resultText').innerHTML='<span class="loading">ğŸ¤” AIæ­£åœ¨ç¼–ç»‡æ•…äº‹...</span>';
        document.getElementById('nextBtn').disabled=true;
        var ai=await generateAIResult(choice.text,gameState.age,phase);
        resultText=ai||("ä½ "+choice.text+"ï¼Œåº¦è¿‡äº†è¿™ä¸€å¹´...");
    }
    document.getElementById('resultText').textContent=resultText;
    document.getElementById('resultOverlay').style.display='flex';
    document.getElementById('nextBtn').disabled=false;
}

function nextYear(){
    document.getElementById('resultOverlay').style.display='none';
    gameState.age++;
    if(gameState.age>90){alert('ğŸ® æ­å–œé€šå…³ï¼æ´»åˆ°'+gameState.age+'å²ï¼');return;}
    generateFortune();
    updateUI();
}

function makeChoice(idx){
    var choices=getChoices(gameState.age,gameState);
    if(idx>=choices.length||idx<0)return;
    var choice=choices[idx];
    if(choice.blocked){alert('âš ï¸ é‡‘é’±ä¸è¶³ï¼');return;}
    if(choice.key)gameState.usedLegendaryChoices.push(choice.key);
    applyEffect(choice.effect);
    gameState.events.push({age:gameState.age,event:choice.text});
    if(checkGameOver())return;
    showResult(choice);
}

function submitFreeChoice(){
    var input=document.getElementById('freeInput');
    if(!input||!input.value.trim()){alert('è¯·è¾“å…¥ï¼');return;}
    var text=input.value.trim();
    var l=text.toLowerCase();
    var effect={};
    if(gameState.age<6)effect={health:5,charm:3};
    else if(gameState.age<18)effect=l.indexOf('å­¦ä¹ ')!==-1?{intelligence:5}:{health:5,charm:3};
    else if(gameState.age>=60)effect={money:5000,health:5};
    else effect=l.indexOf('å·¥ä½œ')!==-1?{money:5000,career:1}:l.indexOf('å¥èº«')!==-1?{health:8}:{money:3000,health:3};
    applyEffect(effect);
    gameState.events.push({age:gameState.age,event:text});
    if(checkGameOver())return;
    showResult({text:text,effect:effect});
}

function updateUI(){
    var phase=getAgePhase(gameState.age);
    var age=gameState.age;
    
    document.getElementById('yearDisplay').textContent='ğŸ‚ ç¬¬ '+age+' å¹´';
    document.getElementById('agePhase').textContent=phase.name;
    document.getElementById('life').textContent=gameState.life+'/200';
    document.getElementById('health').textContent=gameState.health+'/200';
    document.getElementById('money').textContent='Â¥'+gameState.money.toLocaleString();
    document.getElementById('intelligence').textContent=gameState.intelligence+'/200';
    document.getElementById('charm').textContent=gameState.charm+'/200';
    document.getElementById('luck').textContent=gameState.luck+'/200';
    document.getElementById('fame').textContent=gameState.fame;
    document.getElementById('lifeBar').style.width=(gameState.life/2)+'%';
    document.getElementById('healthBar').style.width=(gameState.health/2)+'%';
    document.getElementById('intBar').style.width=(gameState.intelligence/2)+'%';
    document.getElementById('charmBar').style.width=(gameState.charm/2)+'%';
    document.getElementById('luckBar').style.width=(gameState.luck/2)+'%';
    
    var extraKeys=Object.keys(gameState.extraAttrs);
    if(extraKeys.length>0){
        var html='';
        extraKeys.forEach(function(k){var v=gameState.extraAttrs[k];var l={'å…³ç³»':'ğŸ’•','ç»éªŒ':'ğŸ“š','å£°æœ›':'â­','æ•™è‚²':'ğŸ“'}[k]||k;html+='<span class="extra-attr">'+l+' '+k+': <span>'+v+'</span></span>';});
        document.getElementById('extraAttrs').innerHTML=html;
    }else document.getElementById('extraAttrs').innerHTML='';
    
    var avatars=["ğŸ‘¶","ğŸ‘¶","ğŸ‘¶","ğŸ§’","ğŸ§’","ğŸ§’","ğŸ‘¦","ğŸ‘¦","ğŸ‘¦","ğŸ‘¦","ğŸ‘¦","ğŸ‘¦","ğŸ§‘","ğŸ§‘","ğŸ§‘","ğŸ§‘","ğŸ§‘","ğŸ§‘","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘¨","ğŸ‘´"];
    var names=["å©´å„¿","å©´å„¿","å©´å„¿","å¹¼å„¿","å¹¼å„¿","å¹¼å„¿","å„¿ç«¥","å„¿ç«¥","å„¿ç«¥","å„¿ç«¥","å„¿ç«¥","å„¿ç«¥","å°‘å¹´","å°‘å¹´","å°‘å¹´","å°‘å¹´","å°‘å¹´","å°‘å¹´","é’å¹´","é’å¹´","é’å¹´","é’å¹´","é’å¹´","é’å¹´","ä¸­å¹´","ä¸­å¹´","ä¸­å¹´","ä¸­å¹´","ä¸­å¹´","ä¸­å¹´","è€å¹´"];
    document.getElementById('avatar').textContent=avatars[Math.min(age,30)];
    document.getElementById('charName').textContent=names[Math.min(age,30)];
    document.getElementById('charInfo').textContent=age+'å² Â· '+gameState.job;
    document.getElementById('skillsList').innerHTML=gameState.skills.length?gameState.skills.map(function(s){return'<span class="skill-tag">'+s+'</span>'}).join(''):'<span class="skill-tag">æ— </span>';
    document.getElementById('eventLog').innerHTML=gameState.events.slice(-5).map(function(e){return'<div>ğŸŒŸ '+e.age+'å² - '+e.event+'</div>'}).join('');
    
    document.getElementById('sceneImage').textContent=phase.scene;
    document.getElementById('npcAvatar').innerHTML=phase.avatar+'<div class="speak-btn" onclick="speakText()">ğŸ”Š</div>';
    document.getElementById('npcName').textContent=phase.npc;
    document.getElementById('dialogueText').textContent=getDialogue(age);
    
    var choices=getChoices(age,gameState);
    var html='';
    for(var i=0;i<choices.length;i++){
        var c=choices[i];
        var cls='choice-btn'+(c.legendary?' legendary':'');
        var tags='';
        if(c.legendary)tags+='<span class="legendary-tag">â­</span>';
        if(c.blocked)tags+='<span class="blocked-tag">ğŸš«</span>';
        html+='<button class="'+cls+'" onclick="makeChoice('+i+')" '+(c.blocked?'disabled':'')+'>'+c.text+tags+'</button>';
    }
    document.getElementById('choicesList').innerHTML=html;
}

generateGoal();generateFortune();
document.getElementById('submitBtn').onclick=function(){submitFreeChoice()};
updateUI();
</script>
</body>
</html>