<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® AIäººç”Ÿæ¨¡æ‹Ÿå™¨ - ä½ çš„é€‰æ‹©å†³å®šå‘½è¿</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }
        .game-container { max-width: 900px; margin: 0 auto; padding: 20px; min-height: 100vh; }
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-label { font-size: 10px; color: #888; margin-bottom: 5px; }
        .stat-value { font-size: 18px; font-weight: bold; }
        .stat-bar { height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 5px; overflow: hidden; }
        .stat-fill { height: 100%; border-radius: 2px; transition: width 0.3s; }
        .main-area { display: grid; grid-template-columns: 250px 1fr; gap: 20px; }
        @media (max-width: 768px) { .main-area { grid-template-columns: 1fr; } }
        .left-panel { display: flex; flex-direction: column; gap: 15px; }
        .panel { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .panel-title { font-size: 12px; color: #00ff88; margin-bottom: 10px; text-transform: uppercase; }
        .avatar { width: 80px; height: 80px; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; background: linear-gradient(135deg, #667eea, #764ba2); }
        .char-name { text-align: center; font-size: 16px; font-weight: bold; }
        .char-info { text-align: center; font-size: 11px; color: #888; margin-bottom: 10px; }
        .skills-list { display: flex; flex-wrap: wrap; gap: 5px; }
        .skill-tag { padding: 4px 8px; background: rgba(255,255,255,0.1); border-radius: 12px; font-size: 10px; }
        .event-log { max-height: 200px; overflow-y: auto; font-size: 11px; }
        .event-item { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .event-item:last-child { border: none; }
        .event-age { color: #00ff88; }
        .center-area { display: flex; flex-direction: column; gap: 15px; }
        .story-panel { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); flex: 1; }
        .scene-image { width: 100%; height: 150px; background: linear-gradient(135deg, #2d3436, #636e72); border-radius: 8px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; font-size: 60px; }
        .npc-area { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 15px; }
        .npc-avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #fdcb6e, #e17055); display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        .dialogue-box { flex: 1; background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; }
        .npc-name { font-size: 12px; color: #ffd700; margin-bottom: 5px; }
        .dialogue-text { font-size: 14px; line-height: 1.6; }
        .choices-panel { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .choices-title { font-size: 12px; color: #00ccff; margin-bottom: 10px; }
        .choice-btn { display: block; width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; text-align: left; cursor: pointer; margin-bottom: 8px; transition: all 0.3s; }
        .choice-btn:hover { background: rgba(0,255,136,0.1); border-color: #00ff88; transform: translateX(5px); }
        .choice-btn .effect { font-size: 10px; color: #00ff88; margin-top: 5px; }
        .result-box { background: rgba(0,255,136,0.1); border: 1px solid #00ff88; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .result-title { color: #00ff88; font-size: 14px; margin-bottom: 10px; }
        .result-text { font-size: 13px; line-height: 1.6; }
        .free-input { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .free-input input { width: 100%; padding: 10px 15px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: #fff; font-size: 14px; }
        .free-input input:focus { outline: none; border-color: #00ff88; }
        .free-input button { margin-top: 10px; padding: 10px 20px; background: linear-gradient(135deg, #00ff88, #00ccff); border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; }
        .free-input button:hover { transform: scale(1.05); }
        .year-display { text-align: center; font-size: 24px; font-weight: bold; color: #ffd700; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="year-display" id="yearDisplay">ğŸ‚ ç¬¬ 18 å¹´</div>
        <div class="status-bar">
            <div class="stat-item"><div class="stat-label">å¥åº·</div><div class="stat-value" id="health">100</div><div class="stat-bar"><div class="stat-fill" id="healthBar" style="width:100%; background:#00ff88"></div></div></div>
            <div class="stat-item"><div class="stat-label">é‡‘é’±</div><div class="stat-value" id="money">Â¥5000</div></div>
            <div class="stat-item"><div class="stat-label">æ™ºåŠ›</div><div class="stat-value" id="intelligence">50</div><div class="stat-bar"><div class="stat-fill" id="intBar" style="width:50%; background:#00ccff"></div></div></div>
            <div class="stat-item"><div class="stat-label">é­…åŠ›</div><div class="stat-value" id="charm">50</div><div class="stat-bar"><div class="stat-fill" id="charmBar" style="width:50%; background:#ff6b6b"></div></div></div>
            <div class="stat-item"><div class="stat-label">å¹¸è¿</div><div class="stat-value" id="luck">50</div><div class="stat-bar"><div class="stat-fill" id="luckBar" style="width:50%; background:#ffd700"></div></div></div>
            <div class="stat-item"><div class="stat-label">å£°æœ›</div><div class="stat-value" id="fame">0</div></div>
        </div>
        <div class="main-area">
            <div class="left-panel">
                <div class="panel">
                    <div class="avatar" id="avatar">ğŸ‘¤</div>
                    <div class="char-name" id="charName">æ—…è¡Œè€…</div>
                    <div class="char-info" id="charInfo">æ— ä¸š</div>
                </div>
                <div class="panel">
                    <div class="panel-title">ğŸ¯ æŠ€èƒ½</div>
                    <div class="skills-list" id="skillsList"><span class="skill-tag">æ— </span></div>
                </div>
                <div class="panel">
                    <div class="panel-title">ğŸ“œ äººç”Ÿç»å†</div>
                    <div class="event-log" id="eventLog"><div class="event-item">ğŸŒŸ ä½ å‡ºç”Ÿåœ¨ä¸€ä¸ªæ™®é€šå®¶åº­...</div></div>
                </div>
            </div>
            <div class="center-area">
                <div class="story-panel">
                    <div class="scene-image" id="sceneImage">ğŸ </div>
                    <div class="npc-area">
                        <div class="npc-avatar" id="npcAvatar">ğŸ‘¨</div>
                        <div class="dialogue-box">
                            <div class="npc-name" id="npcName">çˆ¶äº²</div>
                            <div class="dialogue-text" id="dialogueText">å­©å­ï¼Œä½ å·²ç»18å²äº†ï¼Œæ˜¯æ—¶å€™ä¸ºè‡ªå·±çš„äººç”Ÿåšå†³å®šäº†ã€‚ä½ æœ‰ä»€ä¹ˆæ‰“ç®—å—ï¼Ÿ</div>
                        </div>
                    </div>
                </div>
                <div class="choices-panel" id="choicesPanel">
                    <div class="choices-title">âœ¨ ä½ å†³å®šï¼š</div>
                    <div id="choicesList"></div>
                    <div class="free-input">
                        <input type="text" id="freeInput" placeholder="ğŸ’¬ è¾“å…¥ä½ çš„æƒ³æ³•ï¼ŒAIä¼šç”Ÿæˆä¸ªæ€§åŒ–é€‰æ‹©..." onkeypress="if(event.key==='Enter')submitFreeChoice()">
                        <button onclick="submitFreeChoice()">æäº¤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            age: 18,
            health: 100,
            money: 5000,
            intelligence: 50,
            charm: 50,
            luck: 50,
            fame: 0,
            skills: [],
            events: [],
            job: "æ— ä¸š",
            relationship: 0,
            careerLevel: 0,
            history: [] // è®°å½•æ‰€æœ‰é€‰æ‹©å†å²ï¼Œå½±å“åç»­
        };

        // äº‹ä»¶ç³»ç»Ÿ - åŸºäºç©å®¶çŠ¶æ€åŠ¨æ€ç”Ÿæˆ
        function generateEvents() {
            const age = gameState.age;
            const history = gameState.history;
            
            // åŸºç¡€äº‹ä»¶åº“
            const baseEvents = {
                18: {
                    npc: "çˆ¶äº²", scene: "ğŸ ", avatar: "ğŸ‘¨",
                    dialogue: "å­©å­ï¼Œä½ å·²ç»18å²äº†ï¼Œæ˜¯æ—¶å€™ä¸ºè‡ªå·±çš„äººç”Ÿåšå†³å®šäº†ã€‚ä½ æœ‰ä»€ä¹ˆæ‰“ç®—å—ï¼Ÿ",
                    choices: [
                        { text: "æ‰¾ä¸€ä»½ç¨³å®šçš„å·¥ä½œ", effect: { money: 3000, skill: "å·¥ä½œç»éªŒ", job: "èŒå‘˜", career: 1 }, result: "ä½ æ‰¾åˆ°äº†ä¸€ä»½å…¬å¸èŒå‘˜çš„å·¥ä½œï¼Œè™½ç„¶å·¥èµ„ä¸é«˜ï¼Œä½†å¾ˆç¨³å®šã€‚" },
                        { text: "ç»§ç»­æ·±é€ ï¼Œè€ƒå¤§å­¦", effect: { money: -5000, intelligence: 15, skill: "é«˜ç­‰æ•™è‚²" }, result: "ä½ åˆ»è‹¦å­¦ä¹ ï¼ŒæˆåŠŸè€ƒå…¥äº†ç†æƒ³çš„å¤§å­¦ï¼" },
                        { text: "åˆ›ä¸šï¼Œåšä¸€ç•ªå¤§äº‹ä¸š", effect: { luck: 60, skill: "åˆ›ä¸šç»éªŒ" }, result: "ä½ å¼€å§‹äº†åˆ›ä¸šä¹‹è·¯ï¼Œå‰é€”æœªåœ..." },
                        { text: "å»æ—…è¡Œï¼Œå¯»æ‰¾äººç”Ÿæ„ä¹‰", effect: { charm: 10, money: -3000, skill: "æ—…è¡Œç»éªŒ" }, result: "ä½ è¸ä¸Šäº†æ—…é€”ï¼Œçœ‹åˆ°äº†å¹¿é˜”çš„ä¸–ç•Œã€‚" }
                    ]
                },
                19: {
                    npc: "å­¦é•¿", scene: "ğŸ«", avatar: "ğŸ‘¨â€ğŸ“",
                    dialogue: gameState.history.includes('å¤§å­¦') ? "å­¦å¼Ÿï¼Œæœ‰ä¸ªåˆ›ä¸šæ¯”èµ›ï¼Œä¸€èµ·å‚åŠ å—ï¼Ÿ" : "å…„å¼Ÿï¼Œæˆ‘ä»¬å…¬å¸æ‹›äººï¼Œæ¥è¯•è¯•ï¼Ÿ",
                    choices: [
                        { text: "å‚åŠ åˆ›ä¸šæ¯”èµ›", condition: () => gameState.intelligence > 55, effect: { fame: 20, money: 5000 }, result: "ä½ çš„é¡¹ç›®è·å¾—äº†å¥–é¡¹ï¼è·å¾—äº†5000å…ƒå¥–é‡‘ï¼" },
                        { text: "å»å…¬å¸å®ä¹ ", condition: () => gameState.skills.includes('å·¥ä½œç»éªŒ'), effect: { money: 2000, skill: "å®ä¹ ç»éªŒ", career: 1 }, result: "å®ä¹ è¡¨ç°ä¸é”™ï¼Œå…¬å¸å†³å®šå½•ç”¨ä½ ã€‚" },
                        { text: "åŠ å…¥ç¤¾å›¢", effect: { charm: 10, skill: "ç¤¾äº¤" }, result: "ä½ è®¤è¯†äº†å¾ˆå¤šæ–°æœ‹å‹ï¼Œç¤¾äº¤èƒ½åŠ›æå‡äº†ã€‚" },
                        { text: "ä¸“æ³¨å­¦ä¹ ", effect: { intelligence: 5 }, result: "ä½ ä¸“æ³¨äºå­¦ä¸šï¼Œæˆç»©æé«˜äº†ã€‚" }
                    ]
                },
                20: {
                    npc: "è€å¸ˆ", scene: "ğŸ«", avatar: "ğŸ‘¨â€ğŸ«",
                    dialogue: gameState.history.includes('åˆ›ä¸š') ? "æœ‰ä¸ªæŠ•èµ„äººæƒ³è§è§ä½ çš„é¡¹ç›®" : "æ¯•ä¸šåçš„è§„åˆ’æƒ³å¥½äº†å—ï¼Ÿ",
                    choices: [
                        { text: "æ¥å—æŠ•èµ„åˆ›ä¸š", condition: () => gameState.history.includes('åˆ›ä¸š') && gameState.money > 3000, effect: { money: 50000, fame: 30, job: "åˆ›ä¸šè€…", career: 2 }, result: "ä½ è·å¾—äº†æŠ•èµ„ï¼Œäº‹ä¸šå¼€å§‹èµ·æ­¥ï¼" },
                        { text: "è€ƒç ”æ·±é€ ", condition: () => gameState.intelligence > 60, effect: { intelligence: 10, money: -10000 }, result: "ä½ å†³å®šç»§ç»­æ·±é€ ï¼Œæ”»è¯»ç¡•å£«å­¦ä½ã€‚" },
                        { text: "æ‰¾å·¥ä½œå°±ä¸š", effect: { money: 5000, job: "èŒå‘˜", career: 2 }, result: "ä½ å¼€å§‹æŠ•ç®€å†ï¼Œå‡†å¤‡æ‰¾å·¥ä½œã€‚" },
                        { text: "é—´éš”å¹´æ—…è¡Œ", effect: { charm: 15, money: -8000 }, result: "ä½ å†³å®šä¼‘æ¯ä¸€å¹´ï¼Œå»æ¢ç´¢ä¸–ç•Œã€‚" }
                    ]
                },
                21: {
                    npc: "åŒäº‹", scene: "ğŸ¢", avatar: "ğŸ‘”",
                    dialogue: gameState.job === "åˆ›ä¸šè€…" ? "è€æ¿ï¼Œæœ‰ä¸ªé‡å¤§æœºä¼šï¼" : "æœ€è¿‘æœ‰ä¸ªæ™‹å‡æœºä¼šï¼Œä½ æƒ³äº‰å–å—ï¼Ÿ",
                    choices: [
                        { text: "æŠ“ä½æœºä¼š", effect: { career: 3, fame: 20, money: 10000 }, result: "ä½ æŠ“ä½äº†æœºä¼šï¼ŒèŒä½æå‡äº†ï¼" },
                        { text: "ç¨³æ­¥å‘å±•", effect: { career: 1, skill: "ä¸“ä¸šæŠ€èƒ½" }, result: "ä½ é€‰æ‹©ç¨³æ­¥å‘å±•ï¼ŒæŠ€èƒ½æå‡äº†ã€‚" },
                        { text: "å¼€æ‹“å‰¯ä¸š", effect: { money: 5000, skill: "å‰¯ä¸š" }, result: "ä½ å¼€å§‹åšå‰¯ä¸šï¼Œæ”¶å…¥å¢åŠ äº†ã€‚" },
                        { text: "å»ºç«‹äººè„‰", effect: { charm: 10, fame: 10 }, result: "ä½ è®¤è¯†äº†å¾ˆå¤šäººï¼Œäººè„‰è¶Šæ¥è¶Šå¹¿ã€‚" }
                    ]
                },
                22: {
                    npc: "æœ‹å‹", scene: "ğŸ‰", avatar: "ğŸ‘«",
                    dialogue: gameState.relationship > 30 ? "æˆ‘ä»¬åœ¨ä¸€èµ·å§ï¼" : "æœ‰ä¸ªå¾ˆé‡è¦çš„äººæƒ³ä»‹ç»ç»™ä½ è®¤è¯†ã€‚",
                    choices: [
                        { text: "æ¥å—è¡¨ç™½", condition: () => gameState.relationship > 30, effect: { relationship: 50, charm: 10 }, result: "ä½ ä»¬åœ¨ä¸€èµ·äº†ï¼æ‰¾åˆ°äº†çœŸçˆ±ï¼" },
                        { text: "å‘å±•äº‹ä¸š", effect: { money: 10000, career: 2 }, result: "ä½ ä¸“æ³¨äºäº‹ä¸šï¼Œæ”¶å…¥æé«˜äº†ã€‚" },
                        { text: "å­¦ä¹ æ–°æŠ€èƒ½", effect: { intelligence: 10, skill: "æ–°æŠ€èƒ½" }, result: "ä½ å­¦ä¼šäº†æ–°æŠ€èƒ½ï¼Œèƒ½åŠ›æå‡äº†ã€‚" },
                        { text: "æ‹“å±•ç¤¾äº¤åœˆ", effect: { charm: 15, fame: 10 }, result: "ä½ çš„ç¤¾äº¤åœˆè¶Šæ¥è¶Šå¤§äº†ã€‚" }
                    ]
                },
                23: {
                    npc: "ä¸Šå¸", scene: "ğŸ¢", avatar: "ğŸ‘¨â€ğŸ’¼",
                    dialogue: gameState.careerLevel >= 3 ? "å…¬å¸å†³å®šè®©ä½ è´Ÿè´£é‡è¦é¡¹ç›®ï¼" : "æœ‰ä¸ªå¤–æ´¾æœºä¼šï¼Œä½ æƒ³å»å—ï¼Ÿ",
                    choices: [
                        { text: "æ¥å—é‡è¦é¡¹ç›®", condition: () => gameState.careerLevel >= 3, effect: { fame: 30, money: 20000, career: 1 }, result: "é¡¹ç›®å¤§è·æˆåŠŸï¼Œä½ æˆäº†å…¬å¸æ˜æ˜Ÿï¼" },
                        { text: "å¤–æ´¾å­¦ä¹ ", effect: { intelligence: 15, skill: "å¤–è¯­" }, result: "ä½ å»äº†æµ·å¤–ï¼Œå­¦ä¹ äº†å¤–è¯­å’Œå…ˆè¿›ç»éªŒã€‚" },
                        { text: "åˆ›ä¸šå•å¹²", condition: () => gameState.money > 30000, effect: { money: -30000, job: "åˆ›ä¸šè€…", fame: 20 }, result: "ä½ å†³å®šè‡ªå·±åˆ›ä¸šå½“è€æ¿ï¼" },
                        { text: "ç»“å©šå®‰å®š", condition: () => gameState.relationship > 40, effect: { relationship: 30, health: 10 }, result: "ä½ ç»“å©šäº†ï¼Œç”Ÿæ´»å¹¸ç¦ç¾æ»¡ã€‚" }
                    ]
                },
                24: {
                    npc: "å®¶äºº", scene: "ğŸ ", avatar: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§",
                    dialogue: gameState.job === "åˆ›ä¸šè€…" ? "å…¬å¸å‘å±•å¾—æ€ä¹ˆæ ·äº†ï¼Ÿ" : "å­©å­ï¼Œæœ€è¿‘å·¥ä½œé¡ºåˆ©å—ï¼Ÿ",
                    choices: [
                        { text: "æ‰©å¤§å…¬å¸è§„æ¨¡", condition: () => gameState.job === "åˆ›ä¸šè€…", effect: { money: 50000, fame: 20 }, result: "å…¬å¸è§„æ¨¡æ‰©å¤§äº†ï¼Œåˆæ‹›è˜äº†æ›´å¤šå‘˜å·¥ï¼" },
                        { text: "æŠ•èµ„ç†è´¢", effect: { money: Math.floor(Math.random() * 20000), skill: "æŠ•èµ„" }, result: "ä½ çš„æŠ•èµ„æ”¶ç›Šä¸é”™ã€‚" },
                        { text: "ç…§é¡¾å®¶åº­", effect: { health: 15, relationship: 10 }, result: "ä½ èŠ±æ—¶é—´é™ªä¼´å®¶äººï¼Œå®¶åº­å’Œç¦ã€‚" },
                        { text: "ç»§ç»­å¥‹æ–—", effect: { career: 2, fame: 10 }, result: "ä½ åŠªåŠ›å·¥ä½œï¼ŒèŒä½åˆæå‡äº†ã€‚" }
                    ]
                },
                25: {
                    npc: "é…å¶", scene: "ğŸ ", avatar: "ğŸ’‘",
                    dialogue: gameState.relationship > 50 ? "æˆ‘ä»¬ç»“å©šå§ï¼" : "æ˜¯æ—¶å€™è€ƒè™‘ç»ˆèº«å¤§äº‹äº†ã€‚",
                    choices: [
                        { text: "ç»“å©š", condition: () => gameState.relationship > 50, effect: { relationship: 50, health: 10, money: -20000 }, result: "ä½ ä»¬ä¸¾è¡Œäº†ç››å¤§çš„å©šç¤¼ï¼" },
                        { text: "æ±‚å©š", condition: () => gameState.relationship > 30, effect: { relationship: 40, money: -10000 }, result: "ä½ æ±‚å©šæˆåŠŸäº†ï¼" },
                        { text: "ä¸“æ³¨äº‹ä¸š", effect: { career: 3, money: 30000 }, result: "ä½ ä¸“æ³¨äºäº‹ä¸šï¼Œä¸šç»©ç¿»å€ï¼" },
                        { text: "å­¦ä¹ è¿›ä¿®", effect: { intelligence: 20, skill: "ä¸“ä¸šè®¤è¯" }, result: "ä½ è·å¾—äº†ä¸“ä¸šè®¤è¯ï¼Œèƒ½åŠ›å¤§å¤§æå‡ï¼" }
                    ]
                }
            };

            // ç”Ÿæˆåç»­å¹´ä»½çš„äº‹ä»¶ï¼ˆåŸºäºä¹‹å‰çš„é€‰æ‹©ï¼‰
            if (!baseEvents[age]) {
                // åŠ¨æ€ç”Ÿæˆåç»­å¹´ä»½äº‹ä»¶
                return generateDynamicEvent(age);
            }
            
            return baseEvents[age];
        }

        // åŠ¨æ€ç”Ÿæˆäº‹ä»¶ - æ ¹æ®ç©å®¶å†å²
        function generateDynamicEvent(age) {
            const baseNPCs = ["æœ‹å‹", "åŒäº‹", "å®¶äºº", "å®¢æˆ·", "é™Œç”Ÿäºº"];
            const baseScenes = ["ğŸ¢", "ğŸ ", "ğŸŒ³", "â˜•", "ğŸ¯"];
            const npc = baseNPCs[age % baseNPCs.length];
            const scene = baseScenes[age % baseScenes.length];
            
            // æ ¹æ®ç©å®¶çŠ¶æ€ç”Ÿæˆä¸ªæ€§åŒ–é€‰é¡¹
            const choices = [];
            
            // äº‹ä¸šç›¸å…³é€‰é¡¹
            if (gameState.careerLevel > 2) {
                choices.push({ 
                    text: "äº‰å–æ›´é«˜èŒä½", 
                    effect: { career: 2, fame: 20, money: 20000 },
                    result: "ä½ æˆåŠŸæ™‹å‡äº†ï¼"
                });
            }
            
            // åˆ›ä¸šç›¸å…³é€‰é¡¹
            if (gameState.money > 50000 && !gameState.history.includes('åˆ›ä¸šæˆåŠŸ')) {
                choices.push({ 
                    text: "åˆ›åŠè‡ªå·±çš„å…¬å¸", 
                    effect: { money: -50000, job: "ä¼ä¸šå®¶", fame: 30, career: 5 },
                    result: "ä½ åˆ›åŠäº†è‡ªå·±çš„å…¬å¸ï¼"
                });
            }
            
            // æŠ•èµ„é€‰é¡¹
            choices.push({ 
                text: "è¿›è¡ŒæŠ•èµ„", 
                effect: { money: Math.floor(Math.random() * 30000 - 5000), skill: "æŠ•èµ„" },
                result: Math.random() > 0.5 ? "æŠ•èµ„è·å¾—äº†ä¸°åšå›æŠ¥ï¼" : "æŠ•èµ„æœ‰äºæŸï¼Œä½†å­¦åˆ°äº†ç»éªŒã€‚"
            });
            
            // ç¤¾äº¤é€‰é¡¹
            choices.push({ 
                text: "å‚åŠ ç¤¾äº¤æ´»åŠ¨", 
                effect: { charm: 5, fame: 5, money: -1000 },
                result: "ä½ è®¤è¯†äº†æ–°æœ‹å‹ï¼Œäººè„‰æ‹“å±•äº†ã€‚"
            });
            
            // å­¦ä¹ é€‰é¡¹
            choices.push({ 
                text: "å­¦ä¹ æ–°æŠ€èƒ½", 
                effect: { intelligence: 5, skill: "æ–°æŠ€èƒ½" },
                result: "ä½ å­¦ä¼šäº†æ–°æŠ€èƒ½ï¼"
            });
            
            // å®¶åº­é€‰é¡¹
            if (gameState.relationship > 30) {
                choices.push({ 
                    text: "é™ªä¼´å®¶äºº", 
                    effect: { health: 10, relationship: 10 },
                    result: "å’Œå®¶äººåœ¨ä¸€èµ·çš„æ—¶å…‰å¾ˆå¹¸ç¦ã€‚"
                });
            }
            
            // æ—…è¡Œé€‰é¡¹
            choices.push({ 
                text: "å»æ—…è¡Œ", 
                effect: { charm: 10, money: -5000, health: 5 },
                result: "æ—…è¡Œè®©ä½ èº«å¿ƒæ„‰æ‚¦ï¼"
            });
            
            return {
                npc: npc,
                scene: scene,
                avatar: "ğŸ‘¤",
                dialogue: generateDialogue(age),
                choices: choices.slice(0, 4)
            };
        }

        // æ ¹æ®ç©å®¶å†å²ç”Ÿæˆå¯¹è¯
        function generateDialogue(age) {
            const dialogues = [
                `ä»Šå¹´ä½ ${age}å²äº†ï¼Œç”Ÿæ´»ä¸­é‡åˆ°äº†ä¸€ä¸ªæ–°çš„é€‰æ‹©...`,
                `åˆä¸€å¹´è¿‡å»äº†ï¼Œä½ å¯¹æœªæ¥æœ‰ä»€ä¹ˆè§„åˆ’ï¼Ÿ`,
                `ç°åœ¨çš„ä½ é¢ä¸´ç€æ–°çš„æŠ‰æ‹©...`,
                `å¹´é¾„ï¼š${age}å²ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„å¹´çºª...`
            ];
            return dialogues[age % dialogues.length];
        }

        // AIç”Ÿæˆè‡ªå®šä¹‰é€‰æ‹©
        function generateAIChoice(userInput) {
            const age = gameState.age;
            const state = gameState;
            
            // åŸºäºç”¨æˆ·è¾“å…¥ç”Ÿæˆåˆé€‚çš„é€‰é¡¹
            let effect = {};
            let result = "";
            
            const input = userInput.toLowerCase();
            
            if (input.includes("å·¥ä½œ") || input.includes("ä¸Šç­") || input.includes("èµšé’±")) {
                effect = { money: 5000 + state.careerLevel * 1000, career: 1, skill: "å·¥ä½œç»éªŒ" };
                result = "ä½ æ‰¾åˆ°äº†å·¥ä½œï¼Œæ”¶å…¥ç¨³å®šäº†ã€‚";
            } else if (input.includes("å­¦ä¹ ") || input.includes("è¯»ä¹¦") || input.includes("è€ƒè¯•")) {
                effect = { intelligence: 10, money: -3000 };
                result = "ä½ åŠªåŠ›å­¦ä¹ ï¼ŒçŸ¥è¯†å¢åŠ äº†ã€‚";
            } else if (input.includes("åˆ›ä¸š") || input.includes("ç”Ÿæ„")) {
                effect = { money: 10000, fame: 10, skill: "åˆ›ä¸šç»éªŒ" };
                result = "ä½ å¼€å§‹äº†åˆ›ä¸šä¹‹è·¯ã€‚";
            } else if (input.includes("æ—…è¡Œ") || input.includes("ç©")) {
                effect = { charm: 10, money: -5000, health: 5 };
                result = "ä½ å‡ºå»æ—…è¡Œï¼Œç©å¾—å¾ˆå¼€å¿ƒï¼";
            } else if (input.includes("å¥èº«") || input.includes("è¿åŠ¨") || input.includes("å¥åº·")) {
                effect = { health: 15 };
                result = "ä½ åšæŒé”»ç‚¼ï¼Œèº«ä½“æ›´å¥åº·äº†ï¼";
            } else if (input.includes("ç¤¾äº¤") || input.includes("è®¤è¯†") || input.includes("æœ‹å‹")) {
                effect = { charm: 10, fame: 5 };
                result: "ä½ è®¤è¯†äº†æ–°æœ‹å‹ï¼Œç¤¾äº¤èƒ½åŠ›æå‡äº†ã€‚";
            } else if (input.includes("æŠ•èµ„") || input.includes("ç†è´¢")) {
                const gain = Math.floor(Math.random() * 20000);
                effect = { money: gain, skill: "æŠ•èµ„" };
                result = gain > 0 ? `æŠ•èµ„èµšäº†${gain}å…ƒï¼` : "æŠ•èµ„æœ‰äºæŸï¼Œä½†å­¦åˆ°äº†ç»éªŒã€‚";
            } else {
                // é»˜è®¤éšæœºæ•ˆæœ
                effect = { money: 2000, health: 5 };
                result = "ä½ åº¦è¿‡äº†å¹³å‡¡ä½†å……å®çš„ä¸€å¹´ã€‚";
            }
            
            return [{
                text: userInput,
                effect: effect,
                result: result
            }];
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('yearDisplay').textContent = `ğŸ‚ ç¬¬ ${gameState.age} å¹´`;
            document.getElementById('health').textContent = gameState.health;
            document.getElementById('money').textContent = 'Â¥' + gameState.money.toLocaleString();
            document.getElementById('intelligence').textContent = gameState.intelligence;
            document.getElementById('charm').textContent = gameState.charm;
            document.getElementById('luck').textContent = gameState.luck;
            document.getElementById('fame').textContent = gameState.fame;
            
            document.getElementById('healthBar').style.width = Math.min(100, gameState.health) + '%';
            document.getElementById('intBar').style.width = Math.min(100, gameState.intelligence) + '%';
            document.getElementById('charmBar').style.width = Math.min(100, gameState.charm) + '%';
            document.getElementById('luckBar').style.width = Math.min(100, gameState.luck) + '%';
            
            document.getElementById('charInfo').textContent = `${gameState.age}å² Â· ${gameState.job}`;
            document.getElementById('skillsList').innerHTML = gameState.skills.length ? 
                gameState.skills.map(s => `<span class="skill-tag">${s}</span>`).join('') : 
                '<span class="skill-tag">æ— </span>';
            
            // æ˜¾ç¤ºæœ€è¿‘çš„äº‹ä»¶
            const recentEvents = gameState.events.slice(-5);
            document.getElementById('eventLog').innerHTML = recentEvents.map(e => 
                `<div class="event-item">ğŸŒŸ <span class="event-age">${e.age}å²</span> - ${e.event}</div>`
            ).join('');
            
            // æ˜¾ç¤ºå½“å‰äº‹ä»¶
            const currentEvent = generateEvents();
            document.getElementById('sceneImage').textContent = currentEvent.scene;
            document.getElementById('npcAvatar').textContent = currentEvent.avatar;
            document.getElementById('npcName').textContent = currentEvent.npc;
            document.getElementById('dialogueText').textContent = currentEvent.dialogue;
            
            // æ˜¾ç¤ºé€‰é¡¹ï¼ˆè¿‡æ»¤æ»¡è¶³æ¡ä»¶çš„ï¼‰
            const validChoices = currentEvent.choices.filter(c => !c.condition || c.condition());
            document.getElementById('choicesList').innerHTML = validChoices.map((c, i) => 
                `<button class="choice-btn" onclick="makeChoice(${i})">${c.text}</button>`
            ).join('');
        }

        // é€‰æ‹©ç»“æœ
        let lastResult = null;
        
        function makeChoice(index) {
            const event = generateEvents();
            const validChoices = event.choices.filter(c => !c.condition || c.condition());
            const choice = validChoices[index];
            
            // åº”ç”¨æ•ˆæœ
            if (choice.effect.money) gameState.money += choice.effect.money;
            if (choice.effect.health) gameState.health += choice.effect.health;
            if (choice.effect.intelligence) gameState.intelligence += choice.effect.intelligence;
            if (choice.effect.charm) gameState.charm += choice.effect.charm;
            if (choice.effect.luck) gameState.luck += choice.effect.luck;
            if (choice.effect.fame) gameState.fame += choice.effect.fame;
            if (choice.effect.career) gameState.careerLevel += choice.effect.career;
            if (choice.effect.relationship) gameState.relationship += choice.effect.relationship;
            if (choice.effect.job) gameState.job = choice.effect.job;
            
            if (choice.effect.skill && !gameState.skills.includes(choice.effect.skill)) {
                gameState.skills.push(choice.effect.skill);
            }
            
            // è®°å½•å†å²
            if (choice.text.includes("åˆ›ä¸š")) gameState.history.push(choice.text.includes("æˆåŠŸ") ? "åˆ›ä¸šæˆåŠŸ" : "åˆ›ä¸š");
            if (choice.text.includes("å¤§å­¦") || choice.text.includes("è€ƒç ”")) gameState.history.push("å¤§å­¦");
            if (choice.text.includes("ç»“å©š")) gameState.history.push("ç»“å©š");
            
            // è®°å½•äº‹ä»¶
            gameState.events.push({ age: gameState.age, event: choice.text });
            
            // ä¿å­˜ç»“æœç”¨äºæ˜¾ç¤º
            lastResult = choice.result;
            
            // é™åˆ¶å±æ€§èŒƒå›´
            gameState.health = Math.max(0, Math.min(100));
            gameState.intelligence = Math.max(0,, gameState.health Math.min(100, gameState.intelligence));
            gameState.charm = Math.max(0, Math.min(100, gameState.charm));
            gameState.luck = Math.max(0, Math.min(100, gameState.luck));
            
            // ç‰¹æ®ŠçŠ¶æ€æ£€æŸ¥
            if (gameState.health <= 0) {
                alert("ğŸ’€ ä½ çš„èº«ä½“æ’‘ä¸ä½äº†... æ¸¸æˆç»“æŸï¼\n\næœ€ç»ˆè¯„åˆ†: " + calculateScore());
                return;
            }
            
            if (gameState.money < -50000) {
                alert("ğŸ’¸ ä½ è´Ÿå€ºç´¯ç´¯äº†... æ¸¸æˆç»“æŸï¼\n\næœ€ç»ˆè¯„åˆ†: " + calculateScore());
                return;
            }
            
            // è¿›å…¥ä¸‹ä¸€å¹´
            gameState.age++;
            
            // æ¯å¹´è‡ªç„¶å˜åŒ–
            if (gameState.age > 65) {
                showEnding();
                return;
            }
            
            // æ˜¾ç¤ºç»“æœ
            showResult(choice.result);
            updateUI();
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(text) {
            const panel = document.getElementById('choicesPanel');
            const resultHTML = `
                <div class="result-box">
                    <div class="result-title">ğŸ“ ä»Šå¹´çš„æ”¶è·</div>
                    <div class="result-text">${text}</div>
                </div>
            `;
            panel.innerHTML = resultHTML + `
                <button class="choice-btn" onclick="continueGame()" style="background: linear-gradient(135deg, #00ff88, #00ccff); color: #000; font-weight: bold;">
                    è¿›å…¥ä¸‹ä¸€å¹´ â†’
                </button>
                <div class="free-input">
                    <input type="text" id="freeInput" placeholder="ğŸ’¬ è¾“å…¥ä½ çš„æƒ³æ³•..." onkeypress="if(event.key==='Enter')submitFreeChoice()">
                    <button onclick="submitFreeChoice()">æäº¤</button>
                </div>
            `;
        }

        // ç»§ç»­æ¸¸æˆ
        function continueGame() {
            updateUI();
        }

        // æäº¤è‡ªç”±è¾“å…¥
        function submitFreeChoice() {
            const input = document.getElementById('freeInput').value.trim();
            if (!input) return;
            
            const choices = generateAIChoice(input);
            const choice = choices[0];
            
            // åº”ç”¨æ•ˆæœ
            if (choice.effect.money) gameState.money += choice.effect.money;
            if (choice.effect.health) gameState.health += choice.effect.health;
            if (choice.effect.intelligence) gameState.intelligence += choice.effect.intelligence;
            if (choice.effect.charm) gameState.charm += choice.effect.charm;
            if (choice.effect.fame) gameState.fame += choice.effect.fame;
            if (choice.effect.skill && !gameState.skills.includes(choice.effect.skill)) {
                gameState.skills.push(choice.effect.skill);
            }
            
            gameState.events.push({ age: gameState.age, event: input });
            
            // é™åˆ¶å±æ€§
            gameState.health = Math.max(0, Math.min(100, gameState.health));
            gameState.intelligence = Math.max(0, Math.min(100, gameState.intelligence));
            gameState.charm = Math.max(0, Math.min(100, gameState.charm));
            gameState.luck = Math.max(0, Math.min(100, gameState.luck));
            
            if (gameState.health <= 0) {
                alert("ğŸ’€ ä½ çš„èº«ä½“æ’‘ä¸ä½äº†... æ¸¸æˆç»“æŸï¼");
                return;
            }
            
            gameState.age++;
            if (gameState.age > 65) {
                showEnding();
                return;
            }
            
            showResult(choice.result);
        }

        // è®¡ç®—å¾—åˆ†
        function calculateScore() {
            let score = 0;
            score += gameState.health;
            score += Math.min(gameState.money / 500, 50);
            score += gameState.intelligence;
            score += gameState.charm;
            score += gameState.luck;
            score += gameState.fame;
            score += gameState.skills.length * 5;
            score += gameState.relationship;
            return Math.floor(score);
        }

        // æ˜¾ç¤ºç»“å±€
        function showEnding() {
            const score = calculateScore();
            let ending = "";
            let emoji = "";
            
            if (score >= 500) {
                ending = "ğŸŒŸ ä¼ å¥‡äººç”Ÿ - ä½ çš„æ•…äº‹å°†è¢«äººä»¬ä¼ é¢‚ï¼";
                emoji = "ğŸ‘‘";
            } else if (score >= 400) {
                ending = "ğŸ† æˆåŠŸäººå£« - ä½ å®ç°äº†è‡ªå·±çš„ç†æƒ³ï¼";
                emoji = "ğŸ’";
            } else if (score >= 300) {
                ending = "ğŸ‘ å……å®äººç”Ÿ - ä½ æ‹¥æœ‰äº†ç²¾å½©çš„äººç”Ÿï¼";
                emoji = "â­";
            } else if (score >= 200) {
                ending = "ğŸ˜Š æ™®é€šç”Ÿæ´» - å¹³æ·¡ä¹Ÿæ˜¯å¹¸ç¦ã€‚";
                emoji = "ğŸŒ¸";
            } else {
                ending = "ğŸ¤” å¹³å‡¡æ˜¯çœŸ - ä½ åº¦è¿‡äº†ç®€å•ä½†çœŸå®çš„ä¸€ç”Ÿã€‚";
                emoji = "ğŸ€";
            }
            
            alert(`ğŸ® æ¸¸æˆç»“æŸï¼\n\n${emoji} ${ending}\n\næœ€ç»ˆè¯„åˆ†: ${score}\n\næ„Ÿè°¢æ¸¸ç©ï¼`);
        }

        // åˆå§‹åŒ–
        updateUI();
    </script>
</body>
</html>
